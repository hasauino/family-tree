{% extends 'main/base.html' %}
{% load i18n %}
{% load static %}

{% block header %}
<link rel="stylesheet" href="{% static "css/edit.css" %}">
{% endblock %}


{% block content %}
{% if user.is_authenticated %}


<div class="container custom-section">
    <div class="row justify-content-center">
        <div class="col-sm-6">
            <form action="{% url 'main:save' orig_id person.id %}" method="post">
                {% csrf_token %}
                {{ form }}
                <div class="edit-buttons-container">
                    <input type="submit" value='{% translate "Save" %}' class="btn btn-primary btn-lg editFormButtons">
                    <button class="btn btn-danger btn-lg editFormButtons" type="button"
                        onclick="window.location = '{% url 'main:person_tree' orig_id%}'"> {% translate "Cancel" %}
                    </button>
                </div>
            </form>
        </div>
        <div class="col-sm-1"></div>
        <div class="col-sm-1">
            <div class="edit-buttons-container">
                {% if user.is_staff %}
                {% if person.access == "public"%}
                <button title="إزالة التوثيق"
                    onclick="window.location = '{% url 'main:disapprove'  person.id orig_id%}' "
                    class="btn btn-link bigGrayButton"><i class="fas fa-lock-open"></i></button>
                {% else %}
                <button title="توثيق" onclick="window.location = '{% url 'main:approve'  person.id orig_id%}' "
                    class="btn btn-link bigBlueButton"><i class="fas fa-lock"></i></button>
                {% endif %}
                {% if person.bookmark %}
                <button title="إزالة العلامة"
                    onclick="window.location = '{% url 'main:unbookmark'  person.id orig_id%}' "
                    class="btn btn-link bigGrayButton"><i class="far fa-star"></i></button>
                {% else %}
                <button title="أضف علامة" onclick="window.location = '{% url 'main:bookmark'  person.id orig_id%}' "
                    class="btn btn-link bigBlueButton"><i class="fas fa-star"></i></button>
                {% endif %}
                {% endif %}
                <button title="حذف الشخص و جميع ذريته"
                    onclick="window.location = '{% url 'main:delete'  person.id orig_id%}' "
                    {% if person.access == "public" and not user.is_staff %} disabled {% endif %}
                    class="btn btn-link bigRedButton"><i class="fa fa-trash"></i>
                </button>
            </div>

        </div>
    </div>
    <br>
    <br>
    <br>

</div>


{% endif %}


<script>

    window.addEventListener("load", () => {
        const childrenInput = document.getElementById("{{form.children.id_for_label}}");
        const choices1 = new Choices(childrenInput, {
            delimiter: ',',
            editItems: true,
            maxItems: 100,
            removeItems: false,
        });

        {% if person.access == "public" and not user.is_staff %}
        const disabledFields = ["name", "reference", "history", "designation"]
        disabledFields.forEach((field_name) => {
            const field = document.getElementById(`id_${field_name}`);
            field.disabled = true;
            field.style.background = "#e9ecef";
        })
        {% endif %}

    });
</script>
{% endblock %}